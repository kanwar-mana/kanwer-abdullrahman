{% comment %}
  EcomExperts Test - Product Grid Section (from scratch)
  - Exactly 6 selectable products
  - Circle hotspots open a popup
  - Popup data loaded dynamically from product JSON endpoints
{% endcomment %}

<section
  class="ecomx-grid"
  data-ecomx-grid
  data-bundle-handle="{{ section.settings.bundle_handle | escape }}"
>
  <div class="page-width">
    {% if section.settings.heading != blank %}
      <h2 class="ecomx-grid__heading">{{ section.settings.heading | escape }}</h2>
    {% endif %}

    <div class="ecomx-grid__items">
      {% assign products_list = '' | split: ',' %}

      {% if section.settings.product_1 != blank %}{% assign products_list = products_list | push: section.settings.product_1 %}{% endif %}
      {% if section.settings.product_2 != blank %}{% assign products_list = products_list | push: section.settings.product_2 %}{% endif %}
      {% if section.settings.product_3 != blank %}{% assign products_list = products_list | push: section.settings.product_3 %}{% endif %}
      {% if section.settings.product_4 != blank %}{% assign products_list = products_list | push: section.settings.product_4 %}{% endif %}
      {% if section.settings.product_5 != blank %}{% assign products_list = products_list | push: section.settings.product_5 %}{% endif %}
      {% if section.settings.product_6 != blank %}{% assign products_list = products_list | push: section.settings.product_6 %}{% endif %}

      {% for p in products_list %}
        {% assign product_obj = all_products[p] %}
        {% if product_obj %}
          <article class="ecomx-card" data-ecomx-product-card data-handle="{{ product_obj.handle | escape }}">
            <a class="ecomx-card__media" href="{{ product_obj.url }}">
              {% if product_obj.featured_image %}
                {{ product_obj.featured_image | image_url: width: 900 | image_tag: loading: 'lazy', class: 'ecomx-card__img' }}
              {% endif %}
            </a>

            <div class="ecomx-card__info">
              <h3 class="ecomx-card__title">{{ product_obj.title | escape }}</h3>
              <p class="ecomx-card__price">{{ product_obj.price | money }}</p>
            </div>

            {% comment %}
              The “little circle” hotspot button.
              Position it via CSS according to Figma.
            {% endcomment %}
            <button
              class="ecomx-hotspot"
              type="button"
              aria-label="Quick view {{ product_obj.title | escape }}"
              data-ecomx-open
              data-handle="{{ product_obj.handle | escape }}"
            >
              <span class="ecomx-hotspot__dot" aria-hidden="true"></span>
            </button>
          </article>
        {% endif %}
      {% endfor %}
    </div>
  </div>

  {% comment %}
    Popup markup (single instance)
    We'll populate content via JS
  {% endcomment %}
  <div class="ecomx-modal" hidden data-ecomx-modal>
    <div class="ecomx-modal__overlay" data-ecomx-close></div>

    <div class="ecomx-modal__dialog" role="dialog" aria-modal="true" aria-label="Product quick view">
      <button class="ecomx-modal__close" type="button" aria-label="Close" data-ecomx-close>×</button>

      <div class="ecomx-modal__body">
        <div class="ecomx-modal__media">
          <img alt="" class="ecomx-modal__img" data-ecomx-modal-img />
        </div>

        <div class="ecomx-modal__content">
          <h3 class="ecomx-modal__title" data-ecomx-modal-title></h3>
          <p class="ecomx-modal__price" data-ecomx-modal-price></p>

          <div class="ecomx-modal__desc" data-ecomx-modal-desc></div>

          <form class="ecomx-form" data-ecomx-form>
            <div class="ecomx-variants" data-ecomx-variants></div>

            <button class="ecomx-btn ecomx-btn--primary ecomx-btn--full" type="submit" data-ecomx-atc>
              <span class="ecomx-btn__text">ADD TO CART</span>
              <span class="ecomx-btn__shine" aria-hidden="true"></span>
            </button>

            <p class="ecomx-form__status" role="status" aria-live="polite" data-ecomx-status></p>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "EcomX - Product Grid",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Featured products" },

    { "type": "product", "id": "product_1", "label": "Product 1" },
    { "type": "product", "id": "product_2", "label": "Product 2" },
    { "type": "product", "id": "product_3", "label": "Product 3" },
    { "type": "product", "id": "product_4", "label": "Product 4" },
    { "type": "product", "id": "product_5", "label": "Product 5" },
    { "type": "product", "id": "product_6", "label": "Product 6" },

    {
      "type": "text",
      "id": "bundle_handle",
      "label": "Bundle product handle (Soft Winter Jacket)",
      "default": "soft-winter-jacket",
      "info": "Used for the rule: when Black + Medium is selected, add this product too."
    }
  ],
  "presets": [{ "name": "EcomX - Product Grid" }]
}
{% endschema %}
